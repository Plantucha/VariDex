============================= test session starts ==============================
platform linux -- Python 3.13.7, pytest-9.0.2, pluggy-1.6.0 -- /media/michal/647A504F7A50205A/GENOME/Michal/VariDex10/VariDex/venv/bin/python3
cachedir: .pytest_cache
hypothesis profile 'default'
rootdir: /media/michal/647A504F7A50205A/GENOME/Michal/VariDex10/VariDex
configfile: pytest.ini (WARNING: ignoring pytest config in pyproject.toml!)
plugins: typeguard-4.4.4, hypothesis-6.151.3, cov-7.0.0
collecting ... collected 16 items

tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_single_variant_annotation PASSED [  6%]
tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_variant_matching_workflow PASSED [ 12%]
tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_multi_source_integration FAILED [ 18%]
tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_pipeline_with_filtering PASSED [ 25%]
tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_report_generation PASSED [ 31%]
tests/test_integration_e2e.py::TestPerformanceIntegration::test_large_vcf_processing FAILED [ 37%]
tests/test_integration_e2e.py::TestPerformanceIntegration::test_concurrent_matching_performance PASSED [ 43%]
tests/test_integration_e2e.py::TestPerformanceIntegration::test_memory_efficient_processing FAILED [ 50%]
tests/test_integration_e2e.py::TestDataIntegrity::test_roundtrip_vcf_to_dataframe PASSED [ 56%]
tests/test_integration_e2e.py::TestDataIntegrity::test_coordinate_system_consistency PASSED [ 62%]
tests/test_integration_e2e.py::TestDataIntegrity::test_allele_normalization_integrity FAILED [ 68%]
tests/test_integration_e2e.py::TestErrorRecovery::test_pipeline_handles_malformed_input PASSED [ 75%]
tests/test_integration_e2e.py::TestErrorRecovery::test_pipeline_handles_missing_files PASSED [ 81%]
tests/test_integration_e2e.py::TestErrorRecovery::test_pipeline_partial_failure_recovery PASSED [ 87%]
tests/test_integration_e2e.py::TestConfigurationIntegration::test_config_affects_pipeline_behavior FAILED [ 93%]
tests/test_integration_e2e.py::TestConfigurationIntegration::test_config_persistence FAILED [100%]

=================================== FAILURES ===================================
____________ TestEndToEndPipeline.test_e2e_multi_source_integration ____________
tests/test_integration_e2e.py:121: in test_e2e_multi_source_integration
    assert len(annotated) == 1
E   assert 0 == 1
E    +  where 0 = len(Empty DataFrame\nColumns: [CHROM, POS, ID, REF, ALT, QUAL, FILTER, INFO, chromosome, position, reference, alternate, chromosome_ref, position_ref, reference_ref, alternate_ref, clinical_significance, review_status]\nIndex: [])
_____________ TestPerformanceIntegration.test_large_vcf_processing _____________
tests/test_integration_e2e.py:198: in test_large_vcf_processing
    assert len(variants_df) == n_variants
E   assert 1 == 10000
E    +  where 1 = len(  CHROM     POS   ID REF ALT  ...  INFO chromosome position reference  alternate\n0  chr1  100000  rs1   A   G  ...     .       chr1   100000         A          G\n\n[1 rows x 12 columns])
_________ TestPerformanceIntegration.test_memory_efficient_processing __________
tests/test_integration_e2e.py:252: in test_memory_efficient_processing
    assert total_variants == n_variants
E   assert 10000 == 100000
____________ TestDataIntegrity.test_allele_normalization_integrity _____________
venv/lib/python3.13/site-packages/pandas/core/indexes/base.py:3641: in get_loc
    return self._engine.get_loc(casted_key)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pandas/_libs/index.pyx:168: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/index.pyx:197: in pandas._libs.index.IndexEngine.get_loc
    ???
pandas/_libs/hashtable_class_helper.pxi:7668: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
pandas/_libs/hashtable_class_helper.pxi:7676: in pandas._libs.hashtable.PyObjectHashTable.get_item
    ???
E   KeyError: 'ref'

The above exception was the direct cause of the following exception:
tests/test_integration_e2e.py:324: in test_allele_normalization_integrity
    normalized = normalize_alleles(variants)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^
varidex/io/normalization.py:13: in normalize_alleles
    norm_df = df.apply(_norm, axis=1)
              ^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/frame.py:12417: in apply
    return op.apply().__finalize__(self, method="apply")
           ^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/apply.py:1015: in apply
    return self.apply_standard()
           ^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/apply.py:1167: in apply_standard
    results, res_index = self.apply_series_generator()
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/apply.py:1183: in apply_series_generator
    results[i] = self.func(v, *self.args, **self.kwargs)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
varidex/io/normalization.py:8: in _norm
    ref, alt = row["ref"], row["alt"]
               ^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/series.py:959: in __getitem__
    return self._get_value(key)
           ^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/series.py:1046: in _get_value
    loc = self.index.get_loc(label)
          ^^^^^^^^^^^^^^^^^^^^^^^^^
venv/lib/python3.13/site-packages/pandas/core/indexes/base.py:3648: in get_loc
    raise KeyError(key) from err
E   KeyError: 'ref'
______ TestConfigurationIntegration.test_config_affects_pipeline_behavior ______
tests/test_integration_e2e.py:388: in test_config_affects_pipeline_behavior
    assert config.output_dir == tmp_path
E   AssertionError: assert '/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0' == PosixPath('/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0')
E    +  where '/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0' = VariDexConfig(reference_genome='GRCh38', min_quality_score=20.0, min_read_depth=10, max_missing_rate=0.1, population_af_threshold=0.01, rare_variant_threshold=0.001, thread_count=4, chunk_size=1000, enable_caching=True, clinvar_path='', gnomad_path='', dbnsfp_path='', output_format='json', output_directory='/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0', include_annotations=True, acmg_strict_mode=False, require_population_data=False, log_level='INFO', debug_mode=False).output_dir
_____________ TestConfigurationIntegration.test_config_persistence _____________
tests/test_integration_e2e.py:406: in test_config_persistence
    assert loaded_config.output_dir == tmp_path
E   AssertionError: assert '/tmp/pytest-of-michal/pytest-52/test_config_persistence0' == PosixPath('/tmp/pytest-of-michal/pytest-52/test_config_persistence0')
E    +  where '/tmp/pytest-of-michal/pytest-52/test_config_persistence0' = VariDexConfig(reference_genome='GRCh38', min_quality_score=20.0, min_read_depth=10, max_missing_rate=0.1, population_af_threshold=0.01, rare_variant_threshold=0.001, thread_count=4, chunk_size=1000, enable_caching=True, clinvar_path='', gnomad_path='', dbnsfp_path='', output_format='json', output_directory='/tmp/pytest-of-michal/pytest-52/test_config_persistence0', include_annotations=True, acmg_strict_mode=False, require_population_data=False, log_level='INFO', debug_mode=False).output_dir
=============================== warnings summary ===============================
varidex/core/config.py:764
  /media/michal/647A504F7A50205A/GENOME/Michal/VariDex10/VariDex/varidex/core/config.py:764: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.12/migration/
    class VariDexConfig(BaseModel):

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED tests/test_integration_e2e.py::TestEndToEndPipeline::test_e2e_multi_source_integration - assert 0 == 1
 +  where 0 = len(Empty DataFrame\nColumns: [CHROM, POS, ID, REF, ALT, QUAL, FILTER, INFO, chromosome, position, reference, alternate, chromosome_ref, position_ref, reference_ref, alternate_ref, clinical_significance, review_status]\nIndex: [])
FAILED tests/test_integration_e2e.py::TestPerformanceIntegration::test_large_vcf_processing - assert 1 == 10000
 +  where 1 = len(  CHROM     POS   ID REF ALT  ...  INFO chromosome position reference  alternate\n0  chr1  100000  rs1   A   G  ...     .       chr1   100000         A          G\n\n[1 rows x 12 columns])
FAILED tests/test_integration_e2e.py::TestPerformanceIntegration::test_memory_efficient_processing - assert 10000 == 100000
FAILED tests/test_integration_e2e.py::TestDataIntegrity::test_allele_normalization_integrity - KeyError: 'ref'
FAILED tests/test_integration_e2e.py::TestConfigurationIntegration::test_config_affects_pipeline_behavior - AssertionError: assert '/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0' == PosixPath('/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0')
 +  where '/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0' = VariDexConfig(reference_genome='GRCh38', min_quality_score=20.0, min_read_depth=10, max_missing_rate=0.1, population_af_threshold=0.01, rare_variant_threshold=0.001, thread_count=4, chunk_size=1000, enable_caching=True, clinvar_path='', gnomad_path='', dbnsfp_path='', output_format='json', output_directory='/tmp/pytest-of-michal/pytest-52/test_config_affects_pipeline_b0', include_annotations=True, acmg_strict_mode=False, require_population_data=False, log_level='INFO', debug_mode=False).output_dir
FAILED tests/test_integration_e2e.py::TestConfigurationIntegration::test_config_persistence - AssertionError: assert '/tmp/pytest-of-michal/pytest-52/test_config_persistence0' == PosixPath('/tmp/pytest-of-michal/pytest-52/test_config_persistence0')
 +  where '/tmp/pytest-of-michal/pytest-52/test_config_persistence0' = VariDexConfig(reference_genome='GRCh38', min_quality_score=20.0, min_read_depth=10, max_missing_rate=0.1, population_af_threshold=0.01, rare_variant_threshold=0.001, thread_count=4, chunk_size=1000, enable_caching=True, clinvar_path='', gnomad_path='', dbnsfp_path='', output_format='json', output_directory='/tmp/pytest-of-michal/pytest-52/test_config_persistence0', include_annotations=True, acmg_strict_mode=False, require_population_data=False, log_level='INFO', debug_mode=False).output_dir
=================== 6 failed, 10 passed, 1 warning in 0.44s ====================
